<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>üß† Memory Game ‚Äî Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üß© –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"</h1>

    <div class="stats">
      <div>‚è± –í—Ä–µ–º—è: <span id="time">0</span> —Å–µ–∫</div>
      <div>üîÑ –ü–æ–ø—ã—Ç–∫–∏: <span id="moves">0</span></div>
    </div>

    <div id="game-board" class="board"></div>
    <div id="message" class="message"></div>
  </div>

  <!-- === –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–∫—Ä–∏–ø—Ç === -->
  <script defer src="script.js"></script>

  <!-- === Telegram WebApp + –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ === -->
  <script defer>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å tg –∏ –Ω–µ –ª–æ–º–∞—Ç—å –∏–≥—Ä—É
    window.resultSent = false;

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
    function initTelegram() {
      try {
        const wa = window.Telegram?.WebApp;
        if (wa) {
          wa.ready();
          wa.expand();
          console.log("‚úÖ Telegram WebApp –≥–æ—Ç–æ–≤");
          window.tg = wa; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
        } else {
          console.warn("‚ö†Ô∏è Telegram.WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)");
          window.tg = null;
        }
      } catch (e) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebApp:", e);
        window.tg = null;
      }
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ Telegram
    function sendWinResultOnce(time) {
      if (window.resultSent) return;
      window.resultSent = true;

      const payload = { action: "memory_score", time };

      if (!window.tg) {
        console.warn("‚ö†Ô∏è Telegram.WebApp –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:", payload);
        return;
      }

      try {
        console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:", payload);
        window.tg.sendData(JSON.stringify(payload));

        // Telegram –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö —á–∞—Å—Ç–æ —Ç–µ—Ä—è–µ—Ç sendData –ø—Ä–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ ‚Äî
        // –ø–æ—ç—Ç–æ–º—É –∂–¥—ë–º 2.5 —Å–µ–∫ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
        setTimeout(() => {
          try {
            window.tg.close();
            console.log("üö™ WebApp –∑–∞–∫—Ä—ã—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏");
          } catch (err) {
            console.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è WebApp:", err);
          }
        }, 2500);
      } catch (err) {
        console.error("‚ùå –û—à–∏–±–∫–∞ tg.sendData:", err);
      }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–ª–±—ç–∫ ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ script.js –ø—Ä–∏ –ø–æ–±–µ–¥–µ
    window.onMemoryWin = function (time) {
      sendWinResultOnce(time);
    };

    // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    initTelegram();
  </script>
</body>
</html>
