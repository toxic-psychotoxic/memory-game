<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>üß† Memory Game ‚Äî Telegram WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üß© –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å"</h1>
    <div class="stats">
      <div>‚è± –í—Ä–µ–º—è: <span id="time">0</span> —Å–µ–∫</div>
      <div>üîÑ –ü–æ–ø—ã—Ç–∫–∏: <span id="moves">0</span></div>
    </div>
    <div id="game-board" class="board"></div>
    <div id="message" class="message"></div>
  </div>

  <script src="script.js"></script>
  <script>
    // === –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp ===
    let tg = null;
    try {
      tg = window.Telegram?.WebApp || null;
      if (tg) {
        tg.ready();
        tg.expand();
        console.log("‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
      } else {
        console.warn("‚ö†Ô∏è Telegram.WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ –≤–Ω–µ Telegram");
      }
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp:", err);
    }

    // === –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ Telegram ===
    let resultSent = false;

    function sendWinResultOnce(time) {
      if (resultSent) return;
      resultSent = true;

      const payload = {
        action: "memory_score",
        time
      };

      if (!tg) {
        console.warn("‚ö†Ô∏è Telegram.WebApp –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:", payload);
        return;
      }

      try {
        console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:", payload);
        tg.sendData(JSON.stringify(payload));

        // Telegram –∏–Ω–æ–≥–¥–∞ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ —Å—Ä–∞–∑—É –∑–∞–∫—Ä—ã—Ç—å WebApp
        setTimeout(() => {
          try {
            tg.close();
            console.log("üö™ WebApp –∑–∞–∫—Ä—ã—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏");
          } catch (err) {
            console.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ WebApp:", err);
          }
        }, 2500); // ‚Üê –∑–∞–¥–µ—Ä–∂–∫–∞ 2.5 —Å–µ–∫—É–Ω–¥—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É
      } catch (err) {
        console.error("‚ùå –û—à–∏–±–∫–∞ tg.sendData:", err);
      }
    }

    // === –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ script.js –ø—Ä–∏ –ø–æ–±–µ–¥–µ ===
    window.onMemoryWin = function (time) {
      sendWinResultOnce(time);
    };
  </script>
</body>
</html>
